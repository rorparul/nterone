$(function(){function e(e){function n(e){d=e}function t(){d=""}function i(e,n){return"undefined"!=typeof e?e:n}function o(){return s.val()[s.val().length-1]}function a(){return 0===s.val().length}function c(){return" "===o()}function l(){return")"===o()}function r(){return"("===o()}function u(){return c()||a()||r()?!1:!0}var s=e,d="";this.openingBracket=function(e){return t(),a()||c()?!0:(n(i(e,"You cannot use '(' in this place.")),!1)},this.closingBracket=function(e){return t(),l()||u()?!0:(n(i(e,"You cannot use ')' in this place.")),!1)},this.operation=function(){return this.closingBracket("You cannot use operation in this place.")},this.subjectValue=function(){return t(),r()?!0:this.openingBracket("You cannot use subject value in this place.")},this.wholeRule=function(){return t(),a()||c()||r()?(n("You cannot submit rule, it's composed not correctly."),!1):!0},this.errorMessage=function(){return d}}function n(){function n(){return $("#cat_yes").is(":checked")}function t(){$(".categories.hidden").removeClass("hidden"),$(".subjects").addClass("hidden"),$("#op_btn").addClass("hidden"),$("#cl_btn").addClass("hidden")}function i(){$(".categories").addClass("hidden"),$(".subjects.hidden").removeClass("hidden"),$("#op_btn.hidden").removeClass("hidden"),$("#cl_btn.hidden").removeClass("hidden")}function o(){$("#cat_yes").click(function(){t()}),$("#cat_no").click(function(){i()})}function a(e){$("#rule_category_id").val(e.id),$("#category_name").text(e.label)}function c(e){$("#rule_category_operation").val(e.id),$("#category_op").text(e.label)}function l(){$("#q_c").autocomplete({source:"/categories/autocomplete",minLength:2,appendTo:".categories-suggestions",select:function(e,n){return a(n.item),$(this).val(""),!1}})}function r(e){p.val(p.val()+e.label),g.val(g.val()+e.id)}function u(e){$(".content").children("hr").first().after("<div class='alert alert-danger alert-dismissible' role='alert'><button type='button' data-dismiss='alert' class='close' aria-label='Close'><span aria-hidden='true'>\xd7</span></button><p>"+e+"</p></div>"),$(".alert-danger").alert(),$(".alert-danger").delay(4e3).slideUp(200,function(){$(this).alert("close")})}function s(e,n){n?r(e):u(b.errorMessage())}function d(){$("#q").autocomplete({source:"/subjects/autocomplete",minLength:2,appendTo:".subjects-suggestions",select:function(e,n){return s(n.item,b.subjectValue()),$(this).val(""),!1}})}function f(){$("#and_btn").click(function(e){e.preventDefault(),n()?c({id:"*",label:"and"}):s({label:" and ",id:" * "},b.operation())}),$("#or_btn").click(function(e){e.preventDefault(),n()?c({id:"+",label:"or"}):s({label:" or ",id:" + "},b.operation())}),$("#op_btn").click(function(e){e.preventDefault(),s({label:"(",id:"("},b.openingBracket())}),$("#cl_btn").click(function(e){e.preventDefault(),s({label:")",id:")"},b.closingBracket())}),$("#cancel_btn").click(function(e){e.preventDefault(),n()?(a({id:"",label:""}),c({id:"",label:""})):(p.val(""),g.val(""))})}function h(){$(".rule_form").submit(function(e){n()||b.wholeRule()||(e.preventDefault(),u(b.errorMessage()))})}var p=$("#rule_statement"),b=new e(p),g=$("#rule_statement_with_ids");n()?t():i(),o(),l(),d(),f(),h()}new n});