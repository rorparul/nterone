.form-group
  = label_tag "user[options]", "Options"
  = select_tag "user[options]",
               options_for_select([["Change Sales Rep", "change_sales_rep"], ["Mark As Direct Customer", "direct_customer"], ["Mark As Partner Customer", "partner_customer"]]),
               include_blank: true,
               class: 'form-control',
               style: "width: 100%;"  

.form-group.hidden.owner_dropdown
  = label_tag "user[parent_id]", "Owner"
  = select_tag "user[parent_id]",
               options_for_select([]),
               class: 'form-control search-sales-select-3',
               style: "width: 100%;"

.form-buttons
  button.btn.btn-success type="submit" value="true" id="mass-update"
    = t('default.action.mass_update')
  button.btn.btn-default type="button" data-dismiss="modal"
    = t('default.action.cancel')

javascript:
  $("#user_options").on('change', function(){
    if($(this).val() == "change_sales_rep"){
      $(".owner_dropdown").removeClass("hidden");
    }else{
      $(".owner_dropdown").addClass("hidden");
    }
  })
  $('#mass-update').on('click', function() {
    user_ids = []
    $(".users_mass_edit_checkbox:checked").each(function(){
        user_ids.push($(this).val());
    });

    prepare_params = {"user_ids": user_ids}
    if($(".owner_dropdown").hasClass("hidden")){
      prepare_params["user[customer_type]"] = $('#user_options').val();  
    }
    else{
      prepare_params["user[parent_id]"] = $('#user_parent_id').val();
    }
    $.ajax({
      type: "POST",
      url: "#{mass_update_users_path(type: @type)}",
      dataType: 'json',
      data: $.param(prepare_params),
      success:function(data) {
        if($(".owner_dropdown").hasClass("hidden")){
          $.each(user_ids, function( index, value ) {
            if(data["customer_type"] == "direct_customer"){
              $(".customer_type_"+value).text("D");
            }
            else{
              $(".customer_type_"+value).text("P");
            }
          });  
        }else{
          $.each(user_ids, function( index, value ) {
            $("#user-"+value+"-sales-rep").text(data["parent_name"]);
          });  
        }
        $('#myModal').modal('hide');
      }
    });
  });

  $('.search-sales-select-3').select2({
    dropdownParent: $(".search-sales-select-3").closest('.form-group'),
    theme: "bootstrap",
    ajax: {
      url: "#{sales_reps_users_path}",
      dataType: 'json',
      delay: 500,
      data: function(params) {
        return {
          q: params.term
        };
      },
      processResults: function(data) {
        return {
          results: $.map(data.items, function(item) {
            return {
              id: item.id,
              text: item.last_name + ", " + item.first_name
            }
          })
        };
      }
    },
    cache: true,
    minimumInputLength: 3,
    placeholder: 'Please select',
    allowClear: true
  });
