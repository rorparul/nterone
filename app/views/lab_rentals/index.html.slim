- if user_signed_in? && current_user.admin?
  - content_for :actions do
    li
      = link_to new_file_path, remote: true do
        = t('lab_rentals.index.upload_file')

= render 'layouts/tabs'

.container-fluid
  .row
    .col-xs-12
      ul.nav.nav-tabs style='margin-bottom: 10px;'
        li.active role="presentation" title='Labs List'
          = link_to "javascript:void(0)", id: 'btn-list-view', class: 'list_lab' do
            span.glyphicon.glyphicon-th-list
            |  Labs
        li role="presentation" title='Labs Calendar'
          = link_to "javascript:void(0)", id: 'btn-calender-view',class: 'calender_lab', data: { load_calander: "true" } do
            span.glyphicon.glyphicon-calendar
            |  Labs
        li role="presentation" title='Classes List'
          = link_to "javascript:void(0)", id: 'list-view-classes', class: 'list_class' do
            span.glyphicon.glyphicon-th-list
            |  Classes
        li role="presentation" title='Classes &amp; Resource Events Calendar'
          = link_to "javascript:void(0)", id: 'btn-calender-view-classes',class: 'calender_clases', data: { load_calander: "true" } do
            span.glyphicon.glyphicon-calendar
            |  Classes & Resource Events

        = hidden_field_tag :ajax_executed, false
      div.classes_view
        = render partial: 'lab_rental_filter'

      #view-filter-controls.container-muted
        = link_to t('default.action.new'), new_lab_rental_path, class: 'btn btn-green-gradient element-left-side', role: 'button'

        = smart_listing_controls_for(:lab_rentals, { class: 'form-inline' }) do
          .filter.hide
            = text_field_tag :date_start
            = text_field_tag :date_end

          .input-group.element-right-side
            = text_field_tag :filter, '', class: 'search form-control',
                                          placeholder: t('default.action.search'),
                                          autocomplete: :off
            span.input-group-btn
              button.btn.btn-default.disabled type='submit'
                span.glyphicon.glyphicon-search

        - unless user_signed_in? && current_user.partner?
          = select_tag :level_filter, options_for_select([["All", nil], ["Partner", "partner"], ["Individual", "individual"]]), class: 'form-control', style: 'display: inline; width: 170px;'

        .input-group.form-inline.pull-right.input-daterange[data={ provide: 'datepicker', 'date-language': I18n.locale.to_s }]
          .input-group
            span.input-group-btn
              = text_field_tag :_date_start, '', class: 'search form-control element-right-side',
                                                 style: 'border-radius: 4px;',
                                                 data: { linked: '#date_start' },
                                                 placeholder: t('default.placeholder.start_date'),
                                                 autocomplete: :off

          div style='display: inline-block; margin: 6px 0 4px 10px;' -

          .input-group
            span.input-group-btn
              = text_field_tag :_date_end, '', class: 'search form-control element-right-side',
                                               style: 'border-radius: 4px;',
                                               data: { linked: '#date_end' },
                                               placeholder: t('default.placeholder.end_date'),
                                               autocomplete: :off

      #list-view-container
        #list-view
          = smart_listing_render(:lab_rentals)

      #calendar-view-container
        /= select_tag :calender_level_filter, options_for_select([["All", nil], ["Partner", "partner"], ["Individual", "individual"]]), class: 'form-control', style: 'display: inline; width: auto;'

        i.fa.fa-spinner.fa-spin.hidden.calander_loading style="font-size: 24px; position: absolute; right: 172px; top: 55px; color: rgb(15, 115, 185);"
        #calendar-view

javascript:
  $("#level_filter").val("");
  $('.permissions .lab-rentals').addClass('active');

  $("#calendar-view-container").addClass('hidden');
  $("#classes-calendar-view-container").addClass('hidden');

  $("#list-view-classes").click(function(){
    if($("#ajax_executed").val() == "false"){
      $("#ajax_executed").val("true");
      $("#list-view-classes").parent().addClass('active')
      $("#btn-list-view").parent().removeClass('active');
      $("#btn-calender-view").parent().removeClass('active');
      $("#btn-calender-view-classes").parent().removeClass('active')

      $("#list-view-container").addClass('hidden');
      $("#calendar-view-container").addClass('hidden');
      $("#classes-list-view-container").removeClass('hide');
      $("#view-filter-controls").addClass("hidden")
      $("#classes-calendar-view-container").addClass("hidden");
      $(".classes_view").html('<i class="fa fa-spinner fa-spin" style="font-size: 30px; position: absolute; right: 50%; top: 90%; color: rgb(15, 115, 185);"></i>')
      $.ajax({
        type: "GET",
        url: "/admin/classes",
        data: {view_type : "lab_classes_list_view"},
        dataType: "script"
      });
    }
  });

  $("#btn-list-view").on('click', function() {
    if($("#ajax_executed").val() == "false"){
      $("#ajax_executed").val("true");
      $("#btn-list-view").parent().addClass('active');
      $("#btn-calender-view").parent().removeClass('active');

      $("#list-view-classes").parent().removeClass('active')
      $("#btn-calender-view-classes").parent().removeClass('active')

      $("#list-view-container").removeClass('hidden');
      $("#calendar-view-container").addClass('hidden');
      $("#classes-list-view-container").addClass('hide');
      $("#view-filter-controls").removeClass("hidden");
      $("#classes-calendar-view-container").addClass("hidden");

      $(".people_loader").removeClass('hide');

      $.ajax({
        type: "GET",
        url: "/lab-reservations",
        dataType: "script",
        data: {view_type : "lab_list_view"},
      });
    }

  });

  $("#btn-calender-view-classes").on('click', function() {
    if($("#ajax_executed").val() == "false"){
      $("#btn-calender-view-classes").parent().addClass('active');
      $("#btn-list-view").parent().removeClass('active');
      $("#btn-calender-view").parent().removeClass('active');
      $("#list-view-classes").parent().removeClass('active');

      $("#view-filter-controls").addClass('hidden');
      $("#calendar-view-container").addClass('hidden');
      $("#classes-list-view-container").addClass('hide');
      $("#list-view-container").addClass('hidden');

      $("#classes-calendar-view-container").removeClass('hidden')
      $('#calendar-view2').fullCalendar({
        header: {
          left: 'prev,next today',
          center: 'title',
          right: 'month,agendaWeek'
        },
        events: {
            url: '/admin/classes.json',
            dataType: "json"
        },
        loading: function(isLoading, view) {
            if(isLoading) {
              $("#ajax_executed").val("true");
              $(".calander_loading").removeClass('hidden');
            } else {
              $(".calander_loading").addClass('hidden');
              $("#ajax_executed").val("false");
            }
        },
        eventClick: function(event) {
          if (event.url) {
            window.open(event.url);
            return false;
          }
        }

      })
    }
  });

  $("#btn-calender-view").on('click', function() {
    $("#btn-list-view").parent().removeClass('active');
    $("#btn-calender-view").parent().addClass('active');

    $("#list-view-container").addClass('hidden');
    $("#calendar-view-container").removeClass('hidden');

    $('#view-filter-controls').addClass('hidden');

    if($(this).data("loadCalander") == true){
      $('#calendar-view').fullCalendar({
        events: {
          url: '/lab-reservations.json',
          data: function() {
            return {
              level: $("#calender_level_filter").val()
            };
          }
        },
        loading: function(isLoading, view) {
          if(isLoading) {
            $(".calander_loading").removeClass('hidden');
          } else {
              $(".calander_loading").addClass('hidden');
            }
        },
        eventClick: function(event) {
          if (event.url) {
            window.open(event.url);
            return false;
          }
        }
      })
      $(this).data("loadCalander", false)
    }
  })

  $("#level_filter").on("change", function(){
    $.ajax({
      type: "GET",
      url: "/lab-reservations.js",
      data: {level: $(this).val()}
    });
  })

  $("#calender_level_filter").on("change", function(){
    $('#calendar-view').fullCalendar('refetchEvents');
  })
